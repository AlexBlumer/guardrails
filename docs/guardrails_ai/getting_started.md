# Getting Started

In this notebook, we will go through the basics of creating a `RAIL` spec and using Guardrails to enforce it.

## Objective

Our goal is to extract detailed patient information from a medical record. We will use a simple example to demonstrate how Guardrails can be used to enforce a `RAIL` spec.

As an example, we will use the following medical record:

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! Instead, edit the notebook w/the location & name as this file. -->


```python
doctors_notes = """49 y/o Male with chronic macular rash to face & hair, worse in beard, eyebrows & nares.
Itchy, flaky, slightly scaly. Moderate response to OTC steroid cream"""
```

We want our extracted information to contain the following fields:

1. Patient's gender
2. Patient's age
3. A list of symptoms, each with a severity rating and an affected area
4. A list of medications, each with information about the patient's response to the medication


## Installation

To get started, install the `guardrails-ai` package with `pip`. Also, install `pydantic`, `typing`, `openai`, and `rich` for this example.


```python
%pip install guardrails-ai pydantic typing openai rich
```

## Creating a `RAIL` spec

At the heart of `Guardrails` is the `RAIL` spec.

`RAIL` started as a flavor of XML (standing for **R**eliable **AI** markup **L**anguage) that describes the expected structure and type of the output of the LLM, the quality criteria for the output to be valid and corrective actions to be taken if the output is invalid. Rails can be written as Pydantic as well. In this example, we'll be developing a Guard using Pydantic.

A `RAIL` is composed of 2 main components:

1. Output schema
2. Prompt

### Output schema

We start by creating the output schema. The output schema is a Pydantic object that describes the expected structure and type of the output of the LLM.

#### Specifying structure

As mentioned earlier, we want our extracted information to contain the following fields: gender, age, symptoms, and medications. Using a Pydantic `RAIL`, we can create fairly complex output schemas. For example, we can specify that a field is a list of objects, etc. We see an example of this below.


#### RAIL Spec


```python
from pydantic import BaseModel, Field
from typing import List
class Symptom(BaseModel):
    symptom: str = Field(description="Symptom that a patient is experiencing")
    affected_area: str= Field(description="What part of the body the symptom is affecting")

class Medication(BaseModel):
    medication: str = Field(description="Name of the medication the patient is taking")
    response: str = Field(description="How the patient is responding to the medication")

class PatientInfo(BaseModel):
    gender: str = Field(description="Patient's gender")
    age: int = Field(description="Patient's age")
    symptoms: List[Symptom] = Field(description="Symptoms that the patient is currently experiencing. Each symptom should be classified into  separate item in the list.")
    current_meds: List[Medication] = Field(description="Medications the patient is currently taking and their response")
```


That pydantic `RAIL`, when used with a guard, will produce JSON output that looks as follows:
    
  ``` json
  {
      "patient_info": {
          "gender": ...,
          "age": ...,
          "symptoms": [
              {
                  "symptom": ...,
                  "affected area": ...
              },
              ...
          ],
          "current_meds": [
              {
                  "medication": ...,
                  "response": ...
              },
              ...
          ]
      }
  }
  ```

#### Specifying quality criteria

Next, we want to specify the quality criteria for the output to be valid and corrective actions to be taken if the output is invalid. We can do this by adding a `format` tag to each field in the output schema. Format tags can either be enforced by Guardrails, or they can only be suggetions to the LLM. You can see the list of validators enforced by Guardrails [here](../api_reference/validators.md). Additionally, you can create your own custom validators, see examples here [1](../examples/no_secrets_in_generated_text/pydantic), [2](../examples/recipe_generation/pydantic), [3](../examples/valid_chess_moves/pydantic).

As an example, for our use case we specify that the `affected_area` of `symptoms` should be one of the following: `['head', 'neck', 'chest']`. For this, we use the [`valid-choices` validator](https://shreyar.github.io/guardrails/validation/#guardrails.validators.ValidChoices).


#### Specifying corrective actions

Additionally, we can specify how to handle invalid output by adding a `on-fail-...` attribute to an element.

For example, we can specify that if the `affected_area` of a symptom is not one of the valid choices, we should re-prompt the LLM to correct its output.

We do this by adding the `on-fail-valid-choices='reask'` attribute to the `affected_area` field. To see the full list of corrective actions, see [here](https://shreyar.github.io/guardrails/rail/output/#specifying-corrective-actions).


Finally, our updated output schema looks like:

``` python
from guardrails.validators import ValidRange, ValidChoices

class Symptom(BaseModel):
    symptom: str = Field(description="Symptom that a patient is experiencing")
    affected_area: str= Field(
        description="What part of the body the symptom is affecting",
        #(2)!
        validators=[ValidChoices(choices=['head', 'neck', 'chest'], on_fail='reask')]
    ) 

class Medication(BaseModel):
    medication: str = Field(description="Name of the medication the patient is taking")
    response: str = Field(description="How the patient is responding to the medication")

class PatientInfo(BaseModel):
    gender: str = Field(description="Patient's gender")
    age: int = Field(
        description="Patient's age",
        #(1)!
        validators=[ValidRange(min=0, max=100)]
    )
    symptoms: List[Symptom] = Field(description="Symptoms that the patient is currently experiencing. Each symptom should be classified into  separate item in the list.")
    current_meds: List[Medication] = Field(description="Medications the patient is currently taking and their response")
```

1. We specify the `valid-range` validator for the `age` field. This validator takes the min and max arguments, which we pass as `0` and `100` respectively.
2. We specify the `valid-choices` validator for the `affected_area` field. This validator will check that the value of the field is one of the choices specified in the `format` attribute. We specify that if the `affected_area` field fails the `valid-choices` validator, we should re-prompt the LLM to correct its output. This is done by setting the `on-fail-valid-choices` attribute to `reask`.

!!! note
    In order to pass in a list of choices, we wrap the list in curly braces -- `{['head', 'neck', 'chest']}`. Anything inside the curly braces will be evaluated as a Python expression. This allows us to pass in more complex data structures or objects as arguments to the validator. 

### Prompt

The prompt contains high level instructions for the LLM, as well as any parameters that need to be substituted at runtime.

For our use case, we create the following prompt:

```python
prompt = """
Given the following doctor's notes about a patient,
please extract a dictionary that contains the patient's information.  <!-- (1)! -->

${doctors_notes}  <!-- (2)! -->

${gr.complete_json_suffix_v2}  <!-- (3)! -->
"""
```

1. This is the high level instructions for the LLM.
2. This is a prompt parameter that will be substituted at runtime. We will see how to do this in the next section.
3. This is some boilerplate text that formats helps the LLM output a valid JSON object. Guardrails will automatically add this text to the end of the LLM's output. You can see the full list of boilerplate text [here](https://github.com/ShreyaR/guardrails/blob/main/guardrails/constants.xml).


### Full `rail` spec

Putting it all together, you can see what the full `rail` spec for our use case looks like:


```python
from pydantic import BaseModel, Field
from typing import List, Optional
from guardrails.validators import ValidRange, ValidChoices

prompt = """
Given the following doctor's notes about a patient, please extract a dictionary that contains the patient's information.

${doctors_notes}

${gr.complete_json_suffix_v2}
"""

class Symptom(BaseModel):
    symptom: str = Field(description="Symptom that a patient is experiencing")
    affected_area: str = Field(description="What part of the body the symptom is affecting", validators=[ValidChoices(choices=['head', 'neck', 'chest'], on_fail="reask")])

class Medication(BaseModel):
    medication: str = Field(description="Name of the medication the patient is taking")
    response: str = Field(description="How the patient is responding to the medication")


class PatientInfo(BaseModel):
    gender: str = Field(description="Patient's gender")
    age: int = Field(validators=[ValidRange(min=0, max=100, on_fail="fix")])
    symptoms: List[Symptom] = Field(description="Symptoms that the patient is currently experiencing. Each symptom should be classified into a separate item in the list.")
    current_meds: List[Medication] = Field(description="Medications the patient is currently taking and their response")
```

This can also be written using the actual XML based `rail` spec, as found [here](https://github.com/ShreyaR/guardrails/blob/main/docs/guardrails_ai/getting_started.rail).

## Using Guardrails to enforce the `RAIL` spec

We use the `RAIL` spec to create a `Guard` object. The `Guard` object is used to wrap the LLM API call and enforce the `RAIL` spec on the output of the LLM call.


```python
from rich import print

import guardrails as gd

# From pydantic:
guard = gd.Guard.from_pydantic(output_class=PatientInfo, prompt=prompt)

# From XML RAIL spec
# guard = gd.Guard.from_rail('getting_started.rail')
```

We can see that the `Guard` object compiles the `RAIL` output specification and adds it to the provided prompt.

Next, we call the `Guard` object with the LLM API call as the first argument and add any additional arguments to the LLM API call as the remaining arguments.


```python
import openai
import os

# Wrap the OpenAI API call with the `guard` object
raw_llm_output, validated_output = guard(
    openai.Completion.create,
    prompt_params={"doctors_notes": doctors_notes},
    engine="text-davinci-003",
    max_tokens=1024,
    temperature=0.3,
)

# Print the validated output from the LLM
print(validated_output)
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "Async event loop found, but guard was invoked synchronously.For validator parallelization, please call `validate_async` instead.<br />    Async event loop found, but guard was invoked synchronously.For validator parallelization, please call `validate_async` instead.<br /><br /><br /><br />```html<br /><pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"font-weight: bold\">{</span><br />    <span style=\"color: #008000; text-decoration-color: #008000\">'gender'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'Male'</span>,<br />    <span style=\"color: #008000; text-decoration-color: #008000\">'age'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">49</span>,<br />    <span style=\"color: #008000; text-decoration-color: #008000\">'symptoms'</span>: <span style=\"font-weight: bold\">[</span><br />        <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'symptom'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'macular rash'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'affected_area'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'head'</span><span style=\"font-weight: bold\">}</span>,<br />        <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'symptom'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'itchy'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'affected_area'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'neck'</span><span style=\"font-weight: bold\">}</span>,<br />        <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'symptom'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'flaky'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'affected_area'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'chest'</span><span style=\"font-weight: bold\">}</span>,<br />        <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'symptom'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'slightly scaly'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'affected_area'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'chest'</span><span style=\"font-weight: bold\">}</span><br />    <span style=\"font-weight: bold\">]</span>,<br />    <span style=\"color: #008000; text-decoration-color: #008000\">'current_meds'</span>: <span style=\"font-weight: bold\">[{</span><span style=\"color: #008000; text-decoration-color: #008000\">'medication'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'OTC steroid cream'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'response'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'Moderate response'</span><span style=\"font-weight: bold\">}]</span><br /><span style=\"font-weight: bold\">}</span><br /></pre>"}} />

We can see that our output was structured correctly, and that the values of the `affected_area` field were one of the valid choices.

## Inspecting logs to peek under the hood

Guardrails logs all of the steps it takes to enforce the `RAIL` spec. We inspect these logs below to see all the steps Guardrails took to enforce the `RAIL` spec.



### Inspecting Step 1: Getting LLM output


```python
print(guard.state.most_recent_call.history[0].rich_group)
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"background-color: #f0f8ff\">╭──────────────────────────────────────────────────── Prompt ─────────────────────────────────────────────────────╮</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│ Given the following doctor's notes about a patient, please extract a dictionary that contains the patient's     │</span><br /><span style=\"background-color: #f0f8ff\">│ information.                                                                                                    │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│ 49 y/o Male with chronic macular rash to face &amp; hair, worse in beard, eyebrows &amp; nares.                         │</span><br /><span style=\"background-color: #f0f8ff\">│ Itchy, flaky, slightly scaly. Moderate response to OTC steroid cream                                            │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│ Given below is XML that describes the information to extract from this document and the tags to extract it      │</span><br /><span style=\"background-color: #f0f8ff\">│ into.                                                                                                           │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│ &lt;output&gt;                                                                                                        │</span><br /><span style=\"background-color: #f0f8ff\">│     &lt;string name=\"gender\" description=\"Patient's gender\"/&gt;                                                      │</span><br /><span style=\"background-color: #f0f8ff\">│     &lt;integer name=\"age\" format=\"valid-range: min=0 max=100\"/&gt;                                                   │</span><br /><span style=\"background-color: #f0f8ff\">│     &lt;list name=\"symptoms\" description=\"Symptoms that the patient is currently experiencing. Each symptom should │</span><br /><span style=\"background-color: #f0f8ff\">│ be classified into a separate item in the list.\"&gt;                                                               │</span><br /><span style=\"background-color: #f0f8ff\">│         &lt;object&gt;                                                                                                │</span><br /><span style=\"background-color: #f0f8ff\">│             &lt;string name=\"symptom\" description=\"Symptom that a patient is experiencing\"/&gt;                       │</span><br /><span style=\"background-color: #f0f8ff\">│             &lt;string name=\"affected_area\" format=\"valid-choices: choices=['head', 'neck', 'chest']\"              │</span><br /><span style=\"background-color: #f0f8ff\">│ description=\"What part of the body the symptom is affecting\"/&gt;                                                  │</span><br /><span style=\"background-color: #f0f8ff\">│         &lt;/object&gt;                                                                                               │</span><br /><span style=\"background-color: #f0f8ff\">│     &lt;/list&gt;                                                                                                     │</span><br /><span style=\"background-color: #f0f8ff\">│     &lt;list name=\"current_meds\" description=\"Medications the patient is currently taking and their response\"&gt;     │</span><br /><span style=\"background-color: #f0f8ff\">│         &lt;object&gt;                                                                                                │</span><br /><span style=\"background-color: #f0f8ff\">│             &lt;string name=\"medication\" description=\"Name of the medication the patient is taking\"/&gt;              │</span><br /><span style=\"background-color: #f0f8ff\">│             &lt;string name=\"response\" description=\"How the patient is responding to the medication\"/&gt;             │</span><br /><span style=\"background-color: #f0f8ff\">│         &lt;/object&gt;                                                                                               │</span><br /><span style=\"background-color: #f0f8ff\">│     &lt;/list&gt;                                                                                                     │</span><br /><span style=\"background-color: #f0f8ff\">│ &lt;/output&gt;                                                                                                       │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│ ONLY return a valid JSON object (no other text is necessary), where the key of the field in JSON is the `name`  │</span><br /><span style=\"background-color: #f0f8ff\">│ attribute of the corresponding XML, and the value is of the type specified by the corresponding XML's tag. The  │</span><br /><span style=\"background-color: #f0f8ff\">│ JSON MUST conform to the XML format, including any types and format requests e.g. requests for lists, objects   │</span><br /><span style=\"background-color: #f0f8ff\">│ and specific types. Be correct and concise.                                                                     │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│ Here are examples of simple (XML, JSON) pairs that show the expected behavior:                                  │</span><br /><span style=\"background-color: #f0f8ff\">│ - `&lt;string name='foo' format='two-words lower-case' /&gt;` =&gt; `{'foo': 'example one'}`                             │</span><br /><span style=\"background-color: #f0f8ff\">│ - `&lt;list name='bar'&gt;&lt;string format='upper-case' /&gt;&lt;/list&gt;` =&gt; `{\"bar\": ['STRING ONE', 'STRING TWO', etc.]}`     │</span><br /><span style=\"background-color: #f0f8ff\">│ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer name=\"index\"                  │</span><br /><span style=\"background-color: #f0f8ff\">│ format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index': 1}}`                                │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│ Json Output:                                                                                                    │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br /><span style=\"background-color: #e7dfeb\">╭──────────────────────────────────────────────── Message History ────────────────────────────────────────────────╮</span><br /><span style=\"background-color: #e7dfeb\">│ ┏━━━━━━┳━━━━━━━━━┓                                                                                              │</span><br /><span style=\"background-color: #e7dfeb\">│ ┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Role </span><span style=\"background-color: #e7dfeb\">┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Content </span><span style=\"background-color: #e7dfeb\">┃                                                                                              │</span><br /><span style=\"background-color: #e7dfeb\">│ ┡━━━━━━╇━━━━━━━━━┩                                                                                              │</span><br /><span style=\"background-color: #e7dfeb\">│ └──────┴─────────┘                                                                                              │</span><br /><span style=\"background-color: #e7dfeb\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br /><span style=\"background-color: #f5f5dc\">╭──────────────────────────────────────────────── Raw LLM Output ─────────────────────────────────────────────────╮</span><br /><span style=\"background-color: #f5f5dc\">│ {                                                                                                               │</span><br /><span style=\"background-color: #f5f5dc\">│     \"gender\": \"Male\",                                                                                           │</span><br /><span style=\"background-color: #f5f5dc\">│     \"age\": 49,                                                                                                  │</span><br /><span style=\"background-color: #f5f5dc\">│     \"symptoms\": [                                                                                               │</span><br /><span style=\"background-color: #f5f5dc\">│         {                                                                                                       │</span><br /><span style=\"background-color: #f5f5dc\">│             \"symptom\": \"macular rash\",                                                                          │</span><br /><span style=\"background-color: #f5f5dc\">│             \"affected_area\": \"face &amp; hair\"                                                                      │</span><br /><span style=\"background-color: #f5f5dc\">│         },                                                                                                      │</span><br /><span style=\"background-color: #f5f5dc\">│         {                                                                                                       │</span><br /><span style=\"background-color: #f5f5dc\">│             \"symptom\": \"itchy\",                                                                                 │</span><br /><span style=\"background-color: #f5f5dc\">│             \"affected_area\": \"beard, eyebrows &amp; nares\"                                                          │</span><br /><span style=\"background-color: #f5f5dc\">│         },                                                                                                      │</span><br /><span style=\"background-color: #f5f5dc\">│         {                                                                                                       │</span><br /><span style=\"background-color: #f5f5dc\">│             \"symptom\": \"flaky\",                                                                                 │</span><br /><span style=\"background-color: #f5f5dc\">│             \"affected_area\": \"beard, eyebrows &amp; nares\"                                                          │</span><br /><span style=\"background-color: #f5f5dc\">│         },                                                                                                      │</span><br /><span style=\"background-color: #f5f5dc\">│         {                                                                                                       │</span><br /><span style=\"background-color: #f5f5dc\">│             \"symptom\": \"slightly scaly\",                                                                        │</span><br /><span style=\"background-color: #f5f5dc\">│             \"affected_area\": \"beard, eyebrows &amp; nares\"                                                          │</span><br /><span style=\"background-color: #f5f5dc\">│         }                                                                                                       │</span><br /><span style=\"background-color: #f5f5dc\">│     ],                                                                                                          │</span><br /><span style=\"background-color: #f5f5dc\">│     \"current_meds\": [                                                                                           │</span><br /><span style=\"background-color: #f5f5dc\">│         {                                                                                                       │</span><br /><span style=\"background-color: #f5f5dc\">│             \"medication\": \"OTC steroid cream\",                                                                  │</span><br /><span style=\"background-color: #f5f5dc\">│             \"response\": \"Moderate response\"                                                                     │</span><br /><span style=\"background-color: #f5f5dc\">│         }                                                                                                       │</span><br /><span style=\"background-color: #f5f5dc\">│     ]                                                                                                           │</span><br /><span style=\"background-color: #f5f5dc\">│ }                                                                                                               │</span><br /><span style=\"background-color: #f5f5dc\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br /><span style=\"background-color: #f0fff0\">╭─────────────────────────────────────────────── Validated Output ────────────────────────────────────────────────╮</span><br /><span style=\"background-color: #f0fff0\">│ {                                                                                                               │</span><br /><span style=\"background-color: #f0fff0\">│     'gender': 'Male',                                                                                           │</span><br /><span style=\"background-color: #f0fff0\">│     'age': 49,                                                                                                  │</span><br /><span style=\"background-color: #f0fff0\">│     'symptoms': [                                                                                               │</span><br /><span style=\"background-color: #f0fff0\">│         {                                                                                                       │</span><br /><span style=\"background-color: #f0fff0\">│             'symptom': 'macular rash',                                                                          │</span><br /><span style=\"background-color: #f0fff0\">│             'affected_area': FieldReAsk(                                                                        │</span><br /><span style=\"background-color: #f0fff0\">│                 incorrect_value='face &amp; hair',                                                                  │</span><br /><span style=\"background-color: #f0fff0\">│                 fail_results=[                                                                                  │</span><br /><span style=\"background-color: #f0fff0\">│                     FailResult(                                                                                 │</span><br /><span style=\"background-color: #f0fff0\">│                         outcome='fail',                                                                         │</span><br /><span style=\"background-color: #f0fff0\">│                         metadata=None,                                                                          │</span><br /><span style=\"background-color: #f0fff0\">│                         error_message=\"Value face &amp; hair is not in choices ['head', 'neck', 'chest'].\",         │</span><br /><span style=\"background-color: #f0fff0\">│                         fix_value=None                                                                          │</span><br /><span style=\"background-color: #f0fff0\">│                     )                                                                                           │</span><br /><span style=\"background-color: #f0fff0\">│                 ],                                                                                              │</span><br /><span style=\"background-color: #f0fff0\">│                 path=['symptoms', 0, 'affected_area']                                                           │</span><br /><span style=\"background-color: #f0fff0\">│             )                                                                                                   │</span><br /><span style=\"background-color: #f0fff0\">│         },                                                                                                      │</span><br /><span style=\"background-color: #f0fff0\">│         {                                                                                                       │</span><br /><span style=\"background-color: #f0fff0\">│             'symptom': 'itchy',                                                                                 │</span><br /><span style=\"background-color: #f0fff0\">│             'affected_area': FieldReAsk(                                                                        │</span><br /><span style=\"background-color: #f0fff0\">│                 incorrect_value='beard, eyebrows &amp; nares',                                                      │</span><br /><span style=\"background-color: #f0fff0\">│                 fail_results=[                                                                                  │</span><br /><span style=\"background-color: #f0fff0\">│                     FailResult(                                                                                 │</span><br /><span style=\"background-color: #f0fff0\">│                         outcome='fail',                                                                         │</span><br /><span style=\"background-color: #f0fff0\">│                         metadata=None,                                                                          │</span><br /><span style=\"background-color: #f0fff0\">│                         error_message=\"Value beard, eyebrows &amp; nares is not in choices ['head', 'neck',         │</span><br /><span style=\"background-color: #f0fff0\">│ 'chest'].\",                                                                                                     │</span><br /><span style=\"background-color: #f0fff0\">│                         fix_value=None                                                                          │</span><br /><span style=\"background-color: #f0fff0\">│                     )                                                                                           │</span><br /><span style=\"background-color: #f0fff0\">│                 ],                                                                                              │</span><br /><span style=\"background-color: #f0fff0\">│                 path=['symptoms', 1, 'affected_area']                                                           │</span><br /><span style=\"background-color: #f0fff0\">│             )                                                                                                   │</span><br /><span style=\"background-color: #f0fff0\">│         },                                                                                                      │</span><br /><span style=\"background-color: #f0fff0\">│         {                                                                                                       │</span><br /><span style=\"background-color: #f0fff0\">│             'symptom': 'flaky',                                                                                 │</span><br /><span style=\"background-color: #f0fff0\">│             'affected_area': FieldReAsk(                                                                        │</span><br /><span style=\"background-color: #f0fff0\">│                 incorrect_value='beard, eyebrows &amp; nares',                                                      │</span><br /><span style=\"background-color: #f0fff0\">│                 fail_results=[                                                                                  │</span><br /><span style=\"background-color: #f0fff0\">│                     FailResult(                                                                                 │</span><br /><span style=\"background-color: #f0fff0\">│                         outcome='fail',                                                                         │</span><br /><span style=\"background-color: #f0fff0\">│                         metadata=None,                                                                          │</span><br /><span style=\"background-color: #f0fff0\">│                         error_message=\"Value beard, eyebrows &amp; nares is not in choices ['head', 'neck',         │</span><br /><span style=\"background-color: #f0fff0\">│ 'chest'].\",                                                                                                     │</span><br /><span style=\"background-color: #f0fff0\">│                         fix_value=None                                                                          │</span><br /><span style=\"background-color: #f0fff0\">│                     )                                                                                           │</span><br /><span style=\"background-color: #f0fff0\">│                 ],                                                                                              │</span><br /><span style=\"background-color: #f0fff0\">│                 path=['symptoms', 2, 'affected_area']                                                           │</span><br /><span style=\"background-color: #f0fff0\">│             )                                                                                                   │</span><br /><span style=\"background-color: #f0fff0\">│         },                                                                                                      │</span><br /><span style=\"background-color: #f0fff0\">│         {                                                                                                       │</span><br /><span style=\"background-color: #f0fff0\">│             'symptom': 'slightly scaly',                                                                        │</span><br /><span style=\"background-color: #f0fff0\">│             'affected_area': FieldReAsk(                                                                        │</span><br /><span style=\"background-color: #f0fff0\">│                 incorrect_value='beard, eyebrows &amp; nares',                                                      │</span><br /><span style=\"background-color: #f0fff0\">│                 fail_results=[                                                                                  │</span><br /><span style=\"background-color: #f0fff0\">│                     FailResult(                                                                                 │</span><br /><span style=\"background-color: #f0fff0\">│                         outcome='fail',                                                                         │</span><br /><span style=\"background-color: #f0fff0\">│                         metadata=None,                                                                          │</span><br /><span style=\"background-color: #f0fff0\">│                         error_message=\"Value beard, eyebrows &amp; nares is not in choices ['head', 'neck',         │</span><br /><span style=\"background-color: #f0fff0\">│ 'chest'].\",                                                                                                     │</span><br /><span style=\"background-color: #f0fff0\">│                         fix_value=None                                                                          │</span><br /><span style=\"background-color: #f0fff0\">│                     )                                                                                           │</span><br /><span style=\"background-color: #f0fff0\">│                 ],                                                                                              │</span><br /><span style=\"background-color: #f0fff0\">│                 path=['symptoms', 3, 'affected_area']                                                           │</span><br /><span style=\"background-color: #f0fff0\">│             )                                                                                                   │</span><br /><span style=\"background-color: #f0fff0\">│         }                                                                                                       │</span><br /><span style=\"background-color: #f0fff0\">│     ],                                                                                                          │</span><br /><span style=\"background-color: #f0fff0\">│     'current_meds': [                                                                                           │</span><br /><span style=\"background-color: #f0fff0\">│         {'medication': 'OTC steroid cream', 'response': 'Moderate response'}                                    │</span><br /><span style=\"background-color: #f0fff0\">│     ]                                                                                                           │</span><br /><span style=\"background-color: #f0fff0\">│ }                                                                                                               │</span><br /><span style=\"background-color: #f0fff0\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br /></pre>"}} />

We can see that the output returned by the LLM contained invalid values for the `affected_area` field.

On validation, Guardrails created `ReAsk` objects that contains all of the information needed to re-prompt the LLM to correct its output.

### Inspecting Step 2: Re-prompting LLM


```python
print(guard.state.most_recent_call.history[1].rich_group)
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"background-color: #f0f8ff\">╭──────────────────────────────────────────────────── Prompt ─────────────────────────────────────────────────────╮</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│ I was given the following JSON response, which had problems due to incorrect values.                            │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│ {                                                                                                               │</span><br /><span style=\"background-color: #f0f8ff\">│   \"gender\": \"Male\",                                                                                             │</span><br /><span style=\"background-color: #f0f8ff\">│   \"age\": 49,                                                                                                    │</span><br /><span style=\"background-color: #f0f8ff\">│   \"symptoms\": [                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│     {                                                                                                           │</span><br /><span style=\"background-color: #f0f8ff\">│       \"symptom\": \"macular rash\",                                                                                │</span><br /><span style=\"background-color: #f0f8ff\">│       \"affected_area\": {                                                                                        │</span><br /><span style=\"background-color: #f0f8ff\">│         \"incorrect_value\": \"face &amp; hair\",                                                                       │</span><br /><span style=\"background-color: #f0f8ff\">│         \"error_messages\": [                                                                                     │</span><br /><span style=\"background-color: #f0f8ff\">│           \"Value face &amp; hair is not in choices ['head', 'neck', 'chest'].\"                                      │</span><br /><span style=\"background-color: #f0f8ff\">│         ]                                                                                                       │</span><br /><span style=\"background-color: #f0f8ff\">│       }                                                                                                         │</span><br /><span style=\"background-color: #f0f8ff\">│     },                                                                                                          │</span><br /><span style=\"background-color: #f0f8ff\">│     {                                                                                                           │</span><br /><span style=\"background-color: #f0f8ff\">│       \"symptom\": \"itchy\",                                                                                       │</span><br /><span style=\"background-color: #f0f8ff\">│       \"affected_area\": {                                                                                        │</span><br /><span style=\"background-color: #f0f8ff\">│         \"incorrect_value\": \"beard, eyebrows &amp; nares\",                                                           │</span><br /><span style=\"background-color: #f0f8ff\">│         \"error_messages\": [                                                                                     │</span><br /><span style=\"background-color: #f0f8ff\">│           \"Value beard, eyebrows &amp; nares is not in choices ['head', 'neck', 'chest'].\"                          │</span><br /><span style=\"background-color: #f0f8ff\">│         ]                                                                                                       │</span><br /><span style=\"background-color: #f0f8ff\">│       }                                                                                                         │</span><br /><span style=\"background-color: #f0f8ff\">│     },                                                                                                          │</span><br /><span style=\"background-color: #f0f8ff\">│     {                                                                                                           │</span><br /><span style=\"background-color: #f0f8ff\">│       \"symptom\": \"flaky\",                                                                                       │</span><br /><span style=\"background-color: #f0f8ff\">│       \"affected_area\": {                                                                                        │</span><br /><span style=\"background-color: #f0f8ff\">│         \"incorrect_value\": \"beard, eyebrows &amp; nares\",                                                           │</span><br /><span style=\"background-color: #f0f8ff\">│         \"error_messages\": [                                                                                     │</span><br /><span style=\"background-color: #f0f8ff\">│           \"Value beard, eyebrows &amp; nares is not in choices ['head', 'neck', 'chest'].\"                          │</span><br /><span style=\"background-color: #f0f8ff\">│         ]                                                                                                       │</span><br /><span style=\"background-color: #f0f8ff\">│       }                                                                                                         │</span><br /><span style=\"background-color: #f0f8ff\">│     },                                                                                                          │</span><br /><span style=\"background-color: #f0f8ff\">│     {                                                                                                           │</span><br /><span style=\"background-color: #f0f8ff\">│       \"symptom\": \"slightly scaly\",                                                                              │</span><br /><span style=\"background-color: #f0f8ff\">│       \"affected_area\": {                                                                                        │</span><br /><span style=\"background-color: #f0f8ff\">│         \"incorrect_value\": \"beard, eyebrows &amp; nares\",                                                           │</span><br /><span style=\"background-color: #f0f8ff\">│         \"error_messages\": [                                                                                     │</span><br /><span style=\"background-color: #f0f8ff\">│           \"Value beard, eyebrows &amp; nares is not in choices ['head', 'neck', 'chest'].\"                          │</span><br /><span style=\"background-color: #f0f8ff\">│         ]                                                                                                       │</span><br /><span style=\"background-color: #f0f8ff\">│       }                                                                                                         │</span><br /><span style=\"background-color: #f0f8ff\">│     }                                                                                                           │</span><br /><span style=\"background-color: #f0f8ff\">│   ],                                                                                                            │</span><br /><span style=\"background-color: #f0f8ff\">│   \"current_meds\": [                                                                                             │</span><br /><span style=\"background-color: #f0f8ff\">│     {                                                                                                           │</span><br /><span style=\"background-color: #f0f8ff\">│       \"medication\": \"OTC steroid cream\",                                                                        │</span><br /><span style=\"background-color: #f0f8ff\">│       \"response\": \"Moderate response\"                                                                           │</span><br /><span style=\"background-color: #f0f8ff\">│     }                                                                                                           │</span><br /><span style=\"background-color: #f0f8ff\">│   ]                                                                                                             │</span><br /><span style=\"background-color: #f0f8ff\">│ }                                                                                                               │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│ Help me correct the incorrect values based on the given error messages.                                         │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│ Given below is XML that describes the information to extract from this document and the tags to extract it      │</span><br /><span style=\"background-color: #f0f8ff\">│ into.                                                                                                           │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│ &lt;output&gt;                                                                                                        │</span><br /><span style=\"background-color: #f0f8ff\">│     &lt;string name=\"gender\" description=\"Patient's gender\"/&gt;                                                      │</span><br /><span style=\"background-color: #f0f8ff\">│     &lt;integer name=\"age\" format=\"valid-range: min=0 max=100\"/&gt;                                                   │</span><br /><span style=\"background-color: #f0f8ff\">│     &lt;list name=\"symptoms\" description=\"Symptoms that the patient is currently experiencing. Each symptom should │</span><br /><span style=\"background-color: #f0f8ff\">│ be classified into a separate item in the list.\"&gt;                                                               │</span><br /><span style=\"background-color: #f0f8ff\">│         &lt;object&gt;                                                                                                │</span><br /><span style=\"background-color: #f0f8ff\">│             &lt;string name=\"symptom\" description=\"Symptom that a patient is experiencing\"/&gt;                       │</span><br /><span style=\"background-color: #f0f8ff\">│             &lt;string name=\"affected_area\" format=\"valid-choices: choices=['head', 'neck', 'chest']\"              │</span><br /><span style=\"background-color: #f0f8ff\">│ description=\"What part of the body the symptom is affecting\"/&gt;                                                  │</span><br /><span style=\"background-color: #f0f8ff\">│         &lt;/object&gt;                                                                                               │</span><br /><span style=\"background-color: #f0f8ff\">│     &lt;/list&gt;                                                                                                     │</span><br /><span style=\"background-color: #f0f8ff\">│     &lt;list name=\"current_meds\" description=\"Medications the patient is currently taking and their response\"&gt;     │</span><br /><span style=\"background-color: #f0f8ff\">│         &lt;object&gt;                                                                                                │</span><br /><span style=\"background-color: #f0f8ff\">│             &lt;string name=\"medication\" description=\"Name of the medication the patient is taking\"/&gt;              │</span><br /><span style=\"background-color: #f0f8ff\">│             &lt;string name=\"response\" description=\"How the patient is responding to the medication\"/&gt;             │</span><br /><span style=\"background-color: #f0f8ff\">│         &lt;/object&gt;                                                                                               │</span><br /><span style=\"background-color: #f0f8ff\">│     &lt;/list&gt;                                                                                                     │</span><br /><span style=\"background-color: #f0f8ff\">│ &lt;/output&gt;                                                                                                       │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│ ONLY return a valid JSON object (no other text is necessary), where the key of the field in JSON is the `name`  │</span><br /><span style=\"background-color: #f0f8ff\">│ attribute of the corresponding XML, and the value is of the type specified by the corresponding XML's tag. The  │</span><br /><span style=\"background-color: #f0f8ff\">│ JSON MUST conform to the XML format, including any types and format requests e.g. requests for lists, objects   │</span><br /><span style=\"background-color: #f0f8ff\">│ and specific types. Be correct and concise. If you are unsure anywhere, enter `null`.                           │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│ Json Output:                                                                                                    │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">│                                                                                                                 │</span><br /><span style=\"background-color: #f0f8ff\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br /><span style=\"background-color: #fff0f2\">╭───────────────────────────────────────────────── Instructions ──────────────────────────────────────────────────╮</span><br /><span style=\"background-color: #fff0f2\">│                                                                                                                 │</span><br /><span style=\"background-color: #fff0f2\">│ You are a helpful assistant only capable of communicating with valid JSON, and no other text.                   │</span><br /><span style=\"background-color: #fff0f2\">│                                                                                                                 │</span><br /><span style=\"background-color: #fff0f2\">│ ONLY return a valid JSON object (no other text is necessary), where the key of the field in JSON is the `name`  │</span><br /><span style=\"background-color: #fff0f2\">│ attribute of the corresponding XML, and the value is of the type specified by the corresponding XML's tag. The  │</span><br /><span style=\"background-color: #fff0f2\">│ JSON MUST conform to the XML format, including any types and format requests e.g. requests for lists, objects   │</span><br /><span style=\"background-color: #fff0f2\">│ and specific types. Be correct and concise. If you are unsure anywhere, enter `null`.                           │</span><br /><span style=\"background-color: #fff0f2\">│                                                                                                                 │</span><br /><span style=\"background-color: #fff0f2\">│ Here are examples of simple (XML, JSON) pairs that show the expected behavior:                                  │</span><br /><span style=\"background-color: #fff0f2\">│ - `&lt;string name='foo' format='two-words lower-case' /&gt;` =&gt; `{'foo': 'example one'}`                             │</span><br /><span style=\"background-color: #fff0f2\">│ - `&lt;list name='bar'&gt;&lt;string format='upper-case' /&gt;&lt;/list&gt;` =&gt; `{\"bar\": ['STRING ONE', 'STRING TWO', etc.]}`     │</span><br /><span style=\"background-color: #fff0f2\">│ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer name=\"index\"                  │</span><br /><span style=\"background-color: #fff0f2\">│ format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index': 1}}`                                │</span><br /><span style=\"background-color: #fff0f2\">│                                                                                                                 │</span><br /><span style=\"background-color: #fff0f2\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br /><span style=\"background-color: #e7dfeb\">╭──────────────────────────────────────────────── Message History ────────────────────────────────────────────────╮</span><br /><span style=\"background-color: #e7dfeb\">│ No message history.                                                                                             │</span><br /><span style=\"background-color: #e7dfeb\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br /><span style=\"background-color: #f5f5dc\">╭──────────────────────────────────────────────── Raw LLM Output ─────────────────────────────────────────────────╮</span><br /><span style=\"background-color: #f5f5dc\">│ {                                                                                                               │</span><br /><span style=\"background-color: #f5f5dc\">│   \"gender\": \"Male\",                                                                                             │</span><br /><span style=\"background-color: #f5f5dc\">│   \"age\": 49,                                                                                                    │</span><br /><span style=\"background-color: #f5f5dc\">│   \"symptoms\": [                                                                                                 │</span><br /><span style=\"background-color: #f5f5dc\">│     {                                                                                                           │</span><br /><span style=\"background-color: #f5f5dc\">│       \"symptom\": \"macular rash\",                                                                                │</span><br /><span style=\"background-color: #f5f5dc\">│       \"affected_area\": \"head\"                                                                                   │</span><br /><span style=\"background-color: #f5f5dc\">│     },                                                                                                          │</span><br /><span style=\"background-color: #f5f5dc\">│     {                                                                                                           │</span><br /><span style=\"background-color: #f5f5dc\">│       \"symptom\": \"itchy\",                                                                                       │</span><br /><span style=\"background-color: #f5f5dc\">│       \"affected_area\": \"neck\"                                                                                   │</span><br /><span style=\"background-color: #f5f5dc\">│     },                                                                                                          │</span><br /><span style=\"background-color: #f5f5dc\">│     {                                                                                                           │</span><br /><span style=\"background-color: #f5f5dc\">│       \"symptom\": \"flaky\",                                                                                       │</span><br /><span style=\"background-color: #f5f5dc\">│       \"affected_area\": \"chest\"                                                                                  │</span><br /><span style=\"background-color: #f5f5dc\">│     },                                                                                                          │</span><br /><span style=\"background-color: #f5f5dc\">│     {                                                                                                           │</span><br /><span style=\"background-color: #f5f5dc\">│       \"symptom\": \"slightly scaly\",                                                                              │</span><br /><span style=\"background-color: #f5f5dc\">│       \"affected_area\": \"chest\"                                                                                  │</span><br /><span style=\"background-color: #f5f5dc\">│     }                                                                                                           │</span><br /><span style=\"background-color: #f5f5dc\">│   ],                                                                                                            │</span><br /><span style=\"background-color: #f5f5dc\">│   \"current_meds\": [                                                                                             │</span><br /><span style=\"background-color: #f5f5dc\">│     {                                                                                                           │</span><br /><span style=\"background-color: #f5f5dc\">│       \"medication\": \"OTC steroid cream\",                                                                        │</span><br /><span style=\"background-color: #f5f5dc\">│       \"response\": \"Moderate response\"                                                                           │</span><br /><span style=\"background-color: #f5f5dc\">│     }                                                                                                           │</span><br /><span style=\"background-color: #f5f5dc\">│   ]                                                                                                             │</span><br /><span style=\"background-color: #f5f5dc\">│ }                                                                                                               │</span><br /><span style=\"background-color: #f5f5dc\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br /><span style=\"background-color: #f0fff0\">╭─────────────────────────────────────────────── Validated Output ────────────────────────────────────────────────╮</span><br /><span style=\"background-color: #f0fff0\">│ {                                                                                                               │</span><br /><span style=\"background-color: #f0fff0\">│     'gender': 'Male',                                                                                           │</span><br /><span style=\"background-color: #f0fff0\">│     'age': 49,                                                                                                  │</span><br /><span style=\"background-color: #f0fff0\">│     'symptoms': [                                                                                               │</span><br /><span style=\"background-color: #f0fff0\">│         {'symptom': 'macular rash', 'affected_area': 'head'},                                                   │</span><br /><span style=\"background-color: #f0fff0\">│         {'symptom': 'itchy', 'affected_area': 'neck'},                                                          │</span><br /><span style=\"background-color: #f0fff0\">│         {'symptom': 'flaky', 'affected_area': 'chest'},                                                         │</span><br /><span style=\"background-color: #f0fff0\">│         {'symptom': 'slightly scaly', 'affected_area': 'chest'}                                                 │</span><br /><span style=\"background-color: #f0fff0\">│     ],                                                                                                          │</span><br /><span style=\"background-color: #f0fff0\">│     'current_meds': [                                                                                           │</span><br /><span style=\"background-color: #f0fff0\">│         {'medication': 'OTC steroid cream', 'response': 'Moderate response'}                                    │</span><br /><span style=\"background-color: #f0fff0\">│     ]                                                                                                           │</span><br /><span style=\"background-color: #f0fff0\">│ }                                                                                                               │</span><br /><span style=\"background-color: #f0fff0\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br /></pre>"}} />

The prompt to the LLM was fully constructed by Guardrails. Additionally, the prompt only contained the previously invalid values for the `affected_area` field.

On receiving the corrected LLM output, Guardrails merges it with the previously invalid values to create a valid output. It then reruns the validation step to ensure that the output is valid, and returns the output to the user.

### Bonus: See the full history of calls

Guardrails also logs the full history of calls made to the LLM. This can be useful for debugging purposes.


```python
print(guard.state.most_recent_call.tree)
```
    
<CodeOutputBlock dangerouslySetInnerHTML={{ __html: "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Logs<br />├── ╭────────────────────────────────────────────────── Step 0 ───────────────────────────────────────────────────╮<br />│   │ <span style=\"background-color: #f0f8ff\">╭──────────────────────────────────────────────── Prompt ─────────────────────────────────────────────────╮</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ Given the following doctor's notes about a patient, please extract a dictionary that contains the       │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ patient's information.                                                                                  │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ 49 y/o Male with chronic macular rash to face &amp; hair, worse in beard, eyebrows &amp; nares.                 │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ Itchy, flaky, slightly scaly. Moderate response to OTC steroid cream                                    │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ Given below is XML that describes the information to extract from this document and the tags to extract │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ it into.                                                                                                │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ &lt;output&gt;                                                                                                │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│     &lt;string name=\"gender\" description=\"Patient's gender\"/&gt;                                              │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│     &lt;integer name=\"age\" format=\"valid-range: min=0 max=100\"/&gt;                                           │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│     &lt;list name=\"symptoms\" description=\"Symptoms that the patient is currently experiencing. Each        │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ symptom should be classified into a separate item in the list.\"&gt;                                        │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│         &lt;object&gt;                                                                                        │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│             &lt;string name=\"symptom\" description=\"Symptom that a patient is experiencing\"/&gt;               │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│             &lt;string name=\"affected_area\" format=\"valid-choices: choices=['head', 'neck', 'chest']\"      │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ description=\"What part of the body the symptom is affecting\"/&gt;                                          │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│         &lt;/object&gt;                                                                                       │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│     &lt;/list&gt;                                                                                             │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│     &lt;list name=\"current_meds\" description=\"Medications the patient is currently taking and their        │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ response\"&gt;                                                                                              │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│         &lt;object&gt;                                                                                        │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│             &lt;string name=\"medication\" description=\"Name of the medication the patient is taking\"/&gt;      │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│             &lt;string name=\"response\" description=\"How the patient is responding to the medication\"/&gt;     │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│         &lt;/object&gt;                                                                                       │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│     &lt;/list&gt;                                                                                             │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ &lt;/output&gt;                                                                                               │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ ONLY return a valid JSON object (no other text is necessary), where the key of the field in JSON is the │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ `name` attribute of the corresponding XML, and the value is of the type specified by the corresponding  │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ XML's tag. The JSON MUST conform to the XML format, including any types and format requests e.g.        │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ requests for lists, objects and specific types. Be correct and concise.                                 │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ Here are examples of simple (XML, JSON) pairs that show the expected behavior:                          │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ - `&lt;string name='foo' format='two-words lower-case' /&gt;` =&gt; `{'foo': 'example one'}`                     │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ - `&lt;list name='bar'&gt;&lt;string format='upper-case' /&gt;&lt;/list&gt;` =&gt; `{\"bar\": ['STRING ONE', 'STRING TWO',     │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ etc.]}`                                                                                                 │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer name=\"index\"          │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index': 1}}`                        │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│ Json Output:                                                                                            │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0f8ff\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">╭──────────────────────────────────────────── Message History ────────────────────────────────────────────╮</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ ┏━━━━━━┳━━━━━━━━━┓                                                                                      │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ ┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Role </span><span style=\"background-color: #e7dfeb\">┃</span><span style=\"background-color: #e7dfeb; font-weight: bold\"> Content </span><span style=\"background-color: #e7dfeb\">┃                                                                                      │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ ┡━━━━━━╇━━━━━━━━━┩                                                                                      │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">│ └──────┴─────────┘                                                                                      │</span> │<br />│   │ <span style=\"background-color: #e7dfeb\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">╭──────────────────────────────────────────── Raw LLM Output ─────────────────────────────────────────────╮</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│ {                                                                                                       │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│     \"gender\": \"Male\",                                                                                   │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│     \"age\": 49,                                                                                          │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│     \"symptoms\": [                                                                                       │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│             \"symptom\": \"macular rash\",                                                                  │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│             \"affected_area\": \"face &amp; hair\"                                                              │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│             \"symptom\": \"itchy\",                                                                         │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│             \"affected_area\": \"beard, eyebrows &amp; nares\"                                                  │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│             \"symptom\": \"flaky\",                                                                         │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│             \"affected_area\": \"beard, eyebrows &amp; nares\"                                                  │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│         },                                                                                              │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│             \"symptom\": \"slightly scaly\",                                                                │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│             \"affected_area\": \"beard, eyebrows &amp; nares\"                                                  │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│         }                                                                                               │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│     ],                                                                                                  │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│     \"current_meds\": [                                                                                   │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│         {                                                                                               │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│             \"medication\": \"OTC steroid cream\",                                                          │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│             \"response\": \"Moderate response\"                                                             │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│         }                                                                                               │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│     ]                                                                                                   │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">│ }                                                                                                       │</span> │<br />│   │ <span style=\"background-color: #f5f5dc\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />│   │ <span style=\"background-color: #f0fff0\">╭─────────────────────────────────────────── Validated Output ────────────────────────────────────────────╮</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│ {                                                                                                       │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│     'gender': 'Male',                                                                                   │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│     'age': 49,                                                                                          │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│     'symptoms': [                                                                                       │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│         {                                                                                               │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             'symptom': 'macular rash',                                                                  │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             'affected_area': FieldReAsk(                                                                │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                 incorrect_value='face &amp; hair',                                                          │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                 fail_results=[                                                                          │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                     FailResult(                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                         outcome='fail',                                                                 │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                         metadata=None,                                                                  │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                         error_message=\"Value face &amp; hair is not in choices ['head', 'neck', 'chest'].\", │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                         fix_value=None                                                                  │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                     )                                                                                   │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                 ],                                                                                      │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                 path=['symptoms', 0, 'affected_area']                                                   │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             )                                                                                           │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│         },                                                                                              │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│         {                                                                                               │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             'symptom': 'itchy',                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             'affected_area': FieldReAsk(                                                                │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                 incorrect_value='beard, eyebrows &amp; nares',                                              │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                 fail_results=[                                                                          │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                     FailResult(                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                         outcome='fail',                                                                 │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                         metadata=None,                                                                  │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                         error_message=\"Value beard, eyebrows &amp; nares is not in choices ['head', 'neck', │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│ 'chest'].\",                                                                                             │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                         fix_value=None                                                                  │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                     )                                                                                   │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                 ],                                                                                      │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                 path=['symptoms', 1, 'affected_area']                                                   │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             )                                                                                           │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│         },                                                                                              │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│         {                                                                                               │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             'symptom': 'flaky',                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             'affected_area': FieldReAsk(                                                                │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                 incorrect_value='beard, eyebrows &amp; nares',                                              │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                 fail_results=[                                                                          │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                     FailResult(                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                         outcome='fail',                                                                 │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                         metadata=None,                                                                  │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                         error_message=\"Value beard, eyebrows &amp; nares is not in choices ['head', 'neck', │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│ 'chest'].\",                                                                                             │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                         fix_value=None                                                                  │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                     )                                                                                   │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                 ],                                                                                      │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                 path=['symptoms', 2, 'affected_area']                                                   │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             )                                                                                           │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│         },                                                                                              │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│         {                                                                                               │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             'symptom': 'slightly scaly',                                                                │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             'affected_area': FieldReAsk(                                                                │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                 incorrect_value='beard, eyebrows &amp; nares',                                              │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                 fail_results=[                                                                          │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                     FailResult(                                                                         │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                         outcome='fail',                                                                 │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                         metadata=None,                                                                  │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                         error_message=\"Value beard, eyebrows &amp; nares is not in choices ['head', 'neck', │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│ 'chest'].\",                                                                                             │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                         fix_value=None                                                                  │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                     )                                                                                   │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                 ],                                                                                      │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│                 path=['symptoms', 3, 'affected_area']                                                   │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│             )                                                                                           │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│         }                                                                                               │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│     ],                                                                                                  │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│     'current_meds': [                                                                                   │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│         {'medication': 'OTC steroid cream', 'response': 'Moderate response'}                            │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│     ]                                                                                                   │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">│ }                                                                                                       │</span> │<br />│   │ <span style=\"background-color: #f0fff0\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />│   ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯<br />└── ╭────────────────────────────────────────────────── Step 1 ───────────────────────────────────────────────────╮<br />    │ <span style=\"background-color: #f0f8ff\">╭──────────────────────────────────────────────── Prompt ─────────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ I was given the following JSON response, which had problems due to incorrect values.                    │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ {                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│   \"gender\": \"Male\",                                                                                     │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│   \"age\": 49,                                                                                            │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│   \"symptoms\": [                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│       \"symptom\": \"macular rash\",                                                                        │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│       \"affected_area\": {                                                                                │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         \"incorrect_value\": \"face &amp; hair\",                                                               │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         \"error_messages\": [                                                                             │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│           \"Value face &amp; hair is not in choices ['head', 'neck', 'chest'].\"                              │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         ]                                                                                               │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│       }                                                                                                 │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     },                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│       \"symptom\": \"itchy\",                                                                               │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│       \"affected_area\": {                                                                                │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         \"incorrect_value\": \"beard, eyebrows &amp; nares\",                                                   │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         \"error_messages\": [                                                                             │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│           \"Value beard, eyebrows &amp; nares is not in choices ['head', 'neck', 'chest'].\"                  │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         ]                                                                                               │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│       }                                                                                                 │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     },                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│       \"symptom\": \"flaky\",                                                                               │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│       \"affected_area\": {                                                                                │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         \"incorrect_value\": \"beard, eyebrows &amp; nares\",                                                   │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         \"error_messages\": [                                                                             │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│           \"Value beard, eyebrows &amp; nares is not in choices ['head', 'neck', 'chest'].\"                  │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         ]                                                                                               │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│       }                                                                                                 │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     },                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│       \"symptom\": \"slightly scaly\",                                                                      │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│       \"affected_area\": {                                                                                │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         \"incorrect_value\": \"beard, eyebrows &amp; nares\",                                                   │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         \"error_messages\": [                                                                             │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│           \"Value beard, eyebrows &amp; nares is not in choices ['head', 'neck', 'chest'].\"                  │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         ]                                                                                               │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│       }                                                                                                 │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     }                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│   ],                                                                                                    │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│   \"current_meds\": [                                                                                     │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│       \"medication\": \"OTC steroid cream\",                                                                │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│       \"response\": \"Moderate response\"                                                                   │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     }                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│   ]                                                                                                     │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ }                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ Help me correct the incorrect values based on the given error messages.                                 │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ Given below is XML that describes the information to extract from this document and the tags to extract │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ it into.                                                                                                │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ &lt;output&gt;                                                                                                │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     &lt;string name=\"gender\" description=\"Patient's gender\"/&gt;                                              │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     &lt;integer name=\"age\" format=\"valid-range: min=0 max=100\"/&gt;                                           │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     &lt;list name=\"symptoms\" description=\"Symptoms that the patient is currently experiencing. Each        │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ symptom should be classified into a separate item in the list.\"&gt;                                        │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         &lt;object&gt;                                                                                        │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│             &lt;string name=\"symptom\" description=\"Symptom that a patient is experiencing\"/&gt;               │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│             &lt;string name=\"affected_area\" format=\"valid-choices: choices=['head', 'neck', 'chest']\"      │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ description=\"What part of the body the symptom is affecting\"/&gt;                                          │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         &lt;/object&gt;                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     &lt;/list&gt;                                                                                             │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     &lt;list name=\"current_meds\" description=\"Medications the patient is currently taking and their        │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ response\"&gt;                                                                                              │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         &lt;object&gt;                                                                                        │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│             &lt;string name=\"medication\" description=\"Name of the medication the patient is taking\"/&gt;      │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│             &lt;string name=\"response\" description=\"How the patient is responding to the medication\"/&gt;     │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│         &lt;/object&gt;                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│     &lt;/list&gt;                                                                                             │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ &lt;/output&gt;                                                                                               │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ ONLY return a valid JSON object (no other text is necessary), where the key of the field in JSON is the │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ `name` attribute of the corresponding XML, and the value is of the type specified by the corresponding  │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ XML's tag. The JSON MUST conform to the XML format, including any types and format requests e.g.        │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ requests for lists, objects and specific types. Be correct and concise. If you are unsure anywhere,     │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ enter `null`.                                                                                           │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│ Json Output:                                                                                            │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #f0f8ff\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #fff0f2\">╭───────────────────────────────────────────── Instructions ──────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #fff0f2\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #fff0f2\">│ You are a helpful assistant only capable of communicating with valid JSON, and no other text.           │</span> │<br />    │ <span style=\"background-color: #fff0f2\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #fff0f2\">│ ONLY return a valid JSON object (no other text is necessary), where the key of the field in JSON is the │</span> │<br />    │ <span style=\"background-color: #fff0f2\">│ `name` attribute of the corresponding XML, and the value is of the type specified by the corresponding  │</span> │<br />    │ <span style=\"background-color: #fff0f2\">│ XML's tag. The JSON MUST conform to the XML format, including any types and format requests e.g.        │</span> │<br />    │ <span style=\"background-color: #fff0f2\">│ requests for lists, objects and specific types. Be correct and concise. If you are unsure anywhere,     │</span> │<br />    │ <span style=\"background-color: #fff0f2\">│ enter `null`.                                                                                           │</span> │<br />    │ <span style=\"background-color: #fff0f2\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #fff0f2\">│ Here are examples of simple (XML, JSON) pairs that show the expected behavior:                          │</span> │<br />    │ <span style=\"background-color: #fff0f2\">│ - `&lt;string name='foo' format='two-words lower-case' /&gt;` =&gt; `{'foo': 'example one'}`                     │</span> │<br />    │ <span style=\"background-color: #fff0f2\">│ - `&lt;list name='bar'&gt;&lt;string format='upper-case' /&gt;&lt;/list&gt;` =&gt; `{\"bar\": ['STRING ONE', 'STRING TWO',     │</span> │<br />    │ <span style=\"background-color: #fff0f2\">│ etc.]}`                                                                                                 │</span> │<br />    │ <span style=\"background-color: #fff0f2\">│ - `&lt;object name='baz'&gt;&lt;string name=\"foo\" format=\"capitalize two-words\" /&gt;&lt;integer name=\"index\"          │</span> │<br />    │ <span style=\"background-color: #fff0f2\">│ format=\"1-indexed\" /&gt;&lt;/object&gt;` =&gt; `{'baz': {'foo': 'Some String', 'index': 1}}`                        │</span> │<br />    │ <span style=\"background-color: #fff0f2\">│                                                                                                         │</span> │<br />    │ <span style=\"background-color: #fff0f2\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #e7dfeb\">╭──────────────────────────────────────────── Message History ────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #e7dfeb\">│ No message history.                                                                                     │</span> │<br />    │ <span style=\"background-color: #e7dfeb\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╭──────────────────────────────────────────── Raw LLM Output ─────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ {                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│   \"gender\": \"Male\",                                                                                     │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│   \"age\": 49,                                                                                            │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│   \"symptoms\": [                                                                                         │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"symptom\": \"macular rash\",                                                                        │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"affected_area\": \"head\"                                                                           │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     },                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"symptom\": \"itchy\",                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"affected_area\": \"neck\"                                                                           │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     },                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"symptom\": \"flaky\",                                                                               │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"affected_area\": \"chest\"                                                                          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     },                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"symptom\": \"slightly scaly\",                                                                      │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"affected_area\": \"chest\"                                                                          │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     }                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│   ],                                                                                                    │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│   \"current_meds\": [                                                                                     │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     {                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"medication\": \"OTC steroid cream\",                                                                │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│       \"response\": \"Moderate response\"                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│     }                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│   ]                                                                                                     │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">│ }                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f5f5dc\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    │ <span style=\"background-color: #f0fff0\">╭─────────────────────────────────────────── Validated Output ────────────────────────────────────────────╮</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ {                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'gender': 'Male',                                                                                   │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'age': 49,                                                                                          │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'symptoms': [                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'symptom': 'macular rash', 'affected_area': 'head'},                                           │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'symptom': 'itchy', 'affected_area': 'neck'},                                                  │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'symptom': 'flaky', 'affected_area': 'chest'},                                                 │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'symptom': 'slightly scaly', 'affected_area': 'chest'}                                         │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     ],                                                                                                  │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     'current_meds': [                                                                                   │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│         {'medication': 'OTC steroid cream', 'response': 'Moderate response'}                            │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│     ]                                                                                                   │</span> │<br />    │ <span style=\"background-color: #f0fff0\">│ }                                                                                                       │</span> │<br />    │ <span style=\"background-color: #f0fff0\">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span> │<br />    ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯<br /></pre>"}} />
